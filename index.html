<!DOCTYPE html>
<html>

<head>
    <title>QR Code Scanner</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <link href='https://fonts.googleapis.com/css?family=Oswald' rel='stylesheet'>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
</head>

<body style="background: #A1A9AC">
    <div style="width: 320px; height: 568px; left: 0px; top: 0px; position: absolute; background: #A1A9AC"></div>
    <div
        style="height: 81px; left: 37px; top: 40px; position: absolute; text-align: center; color: #D8B95A; font-size: 100px; font-family: Oswald; font-weight: 700; word-wrap: break-word">
        Please Scan a ticket</div>
    <div id="reader" style="width:75%; left: 12%; top: 500px; border: #A1A9AC 0px;"></div>
    <div class="modal" id="qr-result-modal" tabindex="-1" role="dialog">

    </div>


    <script>
        function docReady(fn) {
            // see if DOM is already available
            if (document.readyState === "complete" || document.readyState === "interactive") {
                // call on next available tick
                setTimeout(fn, 1);
            } else {
                document.addEventListener("DOMContentLoaded", fn);
            }
        }

        docReady(function () {
            var lastResult, countResults = 0;

            function onScanSuccess(decodedText, decodedResult) {
                if (decodedText !== lastResult) {
                    ++countResults;
                    lastResult = decodedText;
                    console.log(`Scan result ${decodedText}`, decodedResult);
                    $.ajax({
                        url: "https://dev.iceaccount.co.uk/dashboard/ajax/eventredeemAjax.php",
                        method: "POST",
                        data: { 'transaction_id': decodedText },
                        success: function (data) {
                            $("#qr-result-modal").html(data);
                        }
                    });

                    $('#qr-result-modal').modal('show');
                };
            }


            var html5QrcodeScanner = new Html5QrcodeScanner(
                "reader", { fps: 10, qrbox: 400 });
            html5QrcodeScanner.render(onScanSuccess);
        });
    </script>
</body>

</html>